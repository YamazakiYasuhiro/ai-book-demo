# 基本ルール

## 開発手法

### テスト駆動開発 (TDD)
- すべての機能はTDDアプローチで開発すること
- 実装の前に必ずテストを書く
- Red-Green-Refactorサイクルに従う：
  1. **Red**: 失敗するテストを書く
  2. **Green**: テストを通す最小限のコードを書く
  3. **Refactor**: テストを維持しながらコードを改善する
- 重要なビジネスロジックには高いテストカバレッジを維持する

## アーキテクチャ

### コンテナ構成
- 単一のDockerコンテナに以下を含める：
  - Golang APIサーバー（バックエンド）
  - React Native for Web（フロントエンド、静的ファイルとして配信）
  - SQLiteデータベース
- 外部サービス: OpenAI Assistants API（HTTPS経由でアクセス）

### データベースアクセス制御
- SQLiteへのアクセスはセマフォによる排他制御を使用
- 複雑なトランザクションを避け、シンプルなアトミック操作を優先
- すべてのデータベース操作はセマフォを経由すること

## 技術スタック

| レイヤー | 技術 |
|----------|------|
| コンテナ | Docker |
| バックエンド | Golang |
| フロントエンド | React Native for Web |
| パッケージマネージャ | yarn（npmは使用しない） |
| データベース | SQLite |
| LLM | OpenAI Assistants API |

## コーディング規約

### 言語
- すべてのドキュメント（Markdownファイル等）は日本語で記載する
- すべてのソースコードのコメントは日本語で記載する
- コミットメッセージも日本語で記載する

### Golang
- モダンなGolang構文を使用する：
  - `interface{}` ではなく `any` を使用
  - `for i := 0; i < n; i++ {}` ではなく `for i := range n {}` を使用
- 標準的なGoプロジェクトレイアウトに従う

### フロントエンド (React Native)
- yarnのみを使用（npmは使用しない）
- Reactのベストプラクティスとhooksパターンに従う

## CI/CDプロセス

### コード完了の定義
- すべてのコード変更は、CI/CDプロセスの結合テストまでクリアすることで完了とする
- CI/CDプロセスが失敗した場合、原因を特定し、コードを改善することを繰り返す
- 最終的なコード完了確認は、`./build.sh` をオプションなしで実行して成功すること

### build.sh スクリプト
- `./build.sh` は以下の順序でCI/CDプロセスを実行する：
  1. コンテナ群の停止
  2. 単体テストの実行
  3. コンテナ群のビルド
  4. コンテナ群の起動
  5. 結合テストの実行

### スキップオプション
- `--skip-tests`: 単体テストをスキップ
- `--skip-build`: コンテナビルドをスキップ
- `--skip-start`: コンテナ起動をスキップ
- `--skip-test`: 結合テストをスキップ

**注意**: スキップオプションは開発中の時間短縮のためのみ使用すること。
改善されないプロセスを無視するために使用してはならない。

## テスト規約

### 単体テスト
- 原則として、すべてのGoソースファイルに対応する単体テストファイルを作成する
- 命名規則: `<filename>.go` → `<filename>_test.go`
- 例: `backend/internal/api/conversation.go` → `backend/internal/api/conversation_test.go`
- テストはTDD（テスト駆動開発）のアプローチで開発する

### 結合テスト
- 結合テストは `tests/integration/` に配置する
- テストユーティリティは `tests/utils/` に配置する
- 結合テストはコンテナが起動した状態で実行する
- Web APIの全エンドポイントをテストする

## バージョン管理

- 意味のあるコミットメッセージで頻繁にコミットする
- コミットはアトミックに、単一の変更に焦点を当てる
